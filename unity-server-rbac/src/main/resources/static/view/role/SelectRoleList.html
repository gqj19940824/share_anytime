
<#include "/comm/head.html">
<body>
<style>
    /*.el-input__inner{ width:130px; }*/
    .el-header  {
    }
    .el-header .el-input__inner{ width:140px; }
    .el-date-editor { width:140px !important; }
    .el-main {
        padding: 0px;
        margin: 0px;
        overflow:visible !important;
    }
</style>
<div id="app">
<el-container>
    <el-header>

        <div  style="height:40px;padding-top: 5px;">

            <el-form :inline="true">
                <el-button type="primary" icon="fa fa-check-square-o" @click="dis()">分配</el-button>
            </el-form>

        </div>
    </el-header>
    <el-main>
            <el-table
                    row-style="height:15px"
                    cell-style="padding:5px"
                    :data="tableData"
                    style='width:97%;'
                    :height="tableHeight"
                    @selection-change="handleSelectionChange"
                    border>
                <el-table-column
                        type="selection"
                        width="55">
                </el-table-column>
                <el-table-column
                        type="index"
                        label="序号"
                        width="50">
                </el-table-column>
                <el-table-column
                        prop="name"
                        label="角色名称">
                </el-table-column>

                <el-table-column
                        prop="notes"
                        label="备注">
                </el-table-column>

                <!--<el-table-column
                        prop="editor"
                        label="修改人">
                </el-table-column>

                <el-table-column width="150"
                        prop="gmtModified"
                        label="修改时间">
                </el-table-column>-->
            </el-table>

            <div align="center">
                <el-pagination
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="currentPage"
                        :page-sizes="[10, 20, 30, 40]"
                        :page-size="pagesize"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="totalCount">
                </el-pagination>
            </div>
    </el-main>
</el-container>
</div>

<#include "/comm/js.html">

<script type="text/javascript">

    var vue = loadTable({
            data:{
                search:{
                    userId:{op:"eq",data:"${userId}"}
                }
            },
            methods:{
                dis: function () {
                    var moduleIds = [];
                    var selectionArr = this.multipleSelection;
                    for(var i in selectionArr){
                        moduleIds.push(selectionArr[i].id)
                    }
                    axios.post('${base}/user/userRoleLink',{'id':'${userId}','relationType':0,'moduleIds':moduleIds})
                        .then(function (res) {
                            if (res.data.code === 0) {
                                v.$message({type: 'success', message: res.data.message});
                                v.dialogHide(2);
                                window.parent.frames["${iframe}"].contentWindow.vue.reload();
                            } else {
                                v.$message({type: 'error', message: res.data.message});
                            }
                        }).catch(function (err) {
                        v.$message({type: 'error', message: '网络错误，请稍后重试'});
                    });
                }
            },
            urlList:"${base}/role/userNoDisRoleListByPage",
            urlDel:"${base}/role/delRole/",
            urlEdit:"${base}/role/editEntrance/${iframe}",
            dialogWidth:600,
            dialogHeight:500,
            title:'角色'
        });

</script>
</body>
</html>