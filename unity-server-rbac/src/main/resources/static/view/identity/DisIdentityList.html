
<#include "/comm/head.html">
<body>
<style>
    .el-header .el-input__inner{ width:140px; }
    .el-date-editor { width:140px !important; }
    .el-main {
        padding: 0px;
        margin: 0px;
        overflow:visible !important;
    }
    .el-dialog {
        position: relative;
        margin: 0 auto 50px;
        border-radius: 2px;
        -webkit-box-shadow: 0 1px 3px rgba(0,0,0,.3);
        box-shadow: 0 1px 3px rgba(0,0,0,.3);
        box-sizing: border-box;
        width: 67%!important;
    }
</style>
<div id="app">
<el-container>
    <el-header>
        <div  style="height:40px;padding-top: 5px;">
            <el-form :inline="true">
                <el-button type="primary" icon="el-icon-circle-plus" @click="dis()">待分配列表</el-button>
            </el-form>
        </div>
    </el-header>
    <el-main>
            <el-table
                    row-style="height:15px"
                    cell-style="padding:5px"
                    :data="tableData"
                    style='width:97%;'
                    :height="tableHeight"
                    @selection-change="handleSelectionChange"
                    border>
                <el-table-column
                        type="selection"
                        width="55">
                </el-table-column>
                <el-table-column
                        type="index"
                        label="序号"
                        width="50">
                </el-table-column>
                <el-table-column
                        prop="name"
                        label="身份名称">
                </el-table-column>
                <el-table-column
                        prop="notes"
                        label="备注">
                </el-table-column>
                <el-table-column
                        prop="platform"
                        label="平台"
                        :formatter="formatPlatform">
                </el-table-column>
                <!--<el-table-column width="200"
                        prop="gmtCreate"
                        label="创建时间">
                </el-table-column>-->

                <el-table-column label="操作" width="100">
                    <template slot-scope="scope">
                        <el-button
                                type="danger"
                                size="small"
                                icon="el-icon-remove"
                                @click="removeDis(scope.row)">解除
                        </el-button>
                    </template>
                </el-table-column>

            </el-table>

            <div align="center">
                <el-pagination
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="currentPage"
                        :page-sizes="[10, 20, 30, 40]"
                        :page-size="pagesize"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="totalCount">
                </el-pagination>
            </div>
    </el-main>
</el-container>
</div>

<#include "/comm/js.html">

<script type="text/javascript">

    var vue = loadTable({
            data:{
                search: {
                    userId: {op: "eq", data: "${userId}"}
                }
            },
            methods:{
                formatPlatform: function(row, column) {
                    return row.platform === 1 ? 'PC端' : row.platform === 2 ? '安卓端' : row.platform === 3 ? '苹果端' : row.platform === 4 ? '微信端' : row.platform === 5 ? '小程序端' : row.platform === 6 ? '后台' :'';
                },
                removeDis:async function (row) {
                    let r = await v.$confirm('此操作将解除用户的身份，是否继续？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'}).catch(() => {});
                    if(r=='confirm') {
                        let {data} = await axios.post('${base}/user/userIdentityLinkRemove',{'id':'${userId}','relationType':0,'moduleId':row.id});
                        if (data.code == 0) {
                            this.$message({type: 'success', message: data.message});
                            this.reload();
                        }
                        else {
                            this.$message({type: 'error', message: data.message});

                        }
                    }

                },
                dis: function () {
                    v.dialogShow(2, {
                        title: '可分配身份列表',
                        url: '${base}/identity/userToIdentityEntrance/dialog1/${userId}',
                        width: 700,
                        height: 500
                    })
                }
            },
            urlList:"${base}/identity/userIdentityListByPage",
            urlDel:"${base}/identity/",
            urlEdit:"${base}/identity/editEntrance/${iframe}",
            dialogWidth:700,
            dialogHeight:500,
            title:'身份'
        });

</script>
</body>
</html>



