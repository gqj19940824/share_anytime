
<#include "/comm/head.html">
<body>
<style>
    /*.el-input__inner{ width:130px; }*/
    .el-header  {
        height: 50px!important;
    }
    .el-header .el-input__inner{ width:140px; }
    .el-date-editor { width:140px !important; }
    .el-main {
        padding: 0px;
        margin: 0px;
        overflow:visible !important;
    }
    .el-button--small, .el-button--small.is-round {
        padding: 5px 10px!important;
    }
</style>
<div id="app">
<el-container>
    <el-header>

        <div  style="height:40px;padding-top: 5px;">

            <el-form :inline="true">
                <el-button-group>
                    <el-tooltip v-if="authentication(0)" class="item" effect="dark" content="添加" placement="bottom">
                        <el-button type="primary" icon="el-icon-circle-plus-outline" @click="handleAdd()"></el-button>
                    </el-tooltip>
                    <el-tooltip v-if="authentication(2)" class="item" effect="dark" content="批量删除" placement="bottom">
                        <el-button type="primary" icon="el-icon-delete" @click="handleDelBatch()"></el-button>
                    </el-tooltip>

                </el-button-group>
                <el-form-item>
                </el-form-item>
                <el-form-item label="角色">
                    <el-input   v-model="search.name.data" placeholder="请输入内容"></el-input>
                </el-form-item>
                <el-form-item label="修改人">
                    <el-input   v-model="search.editor.data" placeholder="请输入内容"></el-input>
                </el-form-item>
                <!--<el-form-item label="修改时间">
                    <el-date-picker
                            v-model="search.gmtModified[0].data"
                            type="date"
                            format="yyyy-MM-dd"
                            value-format="yyyy-MM-dd 00:00:00"
                            placeholder="请选择日期">
                    </el-date-picker> 至 <el-date-picker
                        v-model="search.gmtModified[1].data"
                        type="date"
                        format="yyyy-MM-dd"
                        value-format="yyyy-MM-dd 23:59:59"
                        placeholder="请选择日期">
                    </el-date-picker>
                </el-form-item>-->
                <el-button-group>
                    <el-tooltip v-if="authentication(3)" class="item" effect="dark" content="搜索" placement="bottom">
                        <el-button type="primary" icon="el-icon-search" @click="handleSearch()"></el-button>
                    </el-tooltip>
                    <el-tooltip v-if="authentication(3)" class="item" effect="dark" content="清空" placement="bottom">
                        <el-button type="primary" icon="fa fa-repeat" @click="handleReset()"></el-button>
                    </el-tooltip>

                </el-button-group>
            </el-form>

        </div>
    </el-header>
    <el-main>
            <el-table
                    :data="tableData"
                    row-style="height:15px"
                    cell-style="padding:5px"
                    style='width:100%;'
                    stripe="true"
                    :header-cell-style="{
                        'background-color': '#fafafa',
                        'color': '#333',
                        'border-bottom': '1px solid #fafafa'
                    }"
                    :height="tableHeight"
                    @selection-change="handleSelectionChange"
                    border>
                <el-table-column
                        type="selection"
                        width="55">
                </el-table-column>
                <el-table-column
                        type="index"
                        label="序号"
                        width="50">
                </el-table-column>
                <el-table-column
                        prop="name"
                        label="角色名称">
                </el-table-column>

                <el-table-column
                        prop="notes"
                        label="备注">
                </el-table-column>

                <el-table-column
                        prop="editor"
                        :formatter="formatEditor"
                        label="修改人">
                </el-table-column>

                <el-table-column
                        prop="gmtModified"
                        label="修改时间">
                </el-table-column>

                <el-table-column
                        fixed="right"
                        width="400"
                        label="操作">
                    <template slot-scope="scope">

                        <div>
                            <el-button-group>
                                <!--<el-tooltip v-if="authentication(1)" class="item" effect="dark" content="修改角色信息" placement="bottom">-->
                                    <el-button
                                            v-if="authentication(1)"
                                            type="text"
                                            size="small"
                                            @click="handleEdit(scope.$index, scope.row)">修改
                                    </el-button><!--icon="el-icon-edit"-->
                                <!--</el-tooltip>
                                <el-tooltip v-if="authentication(7)" class="item" effect="dark" content="上移" placement="bottom">-->
                                    <el-button
                                            v-if="authentication(7)"
                                            type="text"
                                            size="small"
                                            @click="handleChangeOrder(scope.row.id,0)">上移
                                    </el-button><!--icon="el-icon-arrow-up"-->
                               <!-- </el-tooltip>
                                <el-tooltip v-if="authentication(7)" class="item" effect="dark" content="下移" placement="bottom">-->
                                    <el-button
                                            v-if="authentication(7)"
                                            type="text"
                                            size="small"
                                            @click="handleChangeOrder(scope.row.id,1)">下移
                                    </el-button><!--icon="el-icon-arrow-down"-->
                               <!-- </el-tooltip>
                                <el-tooltip v-if="authentication(33)" class="item" effect="dark" content="功能资源" placement="bottom">-->
                                    <el-button
                                            v-if="authentication(33)"
                                            type="text"
                                            size="small"
                                            @click="openModuleResource(scope.row)">功能资源
                                    </el-button><!--icon="fa fa-scribd"-->
                                <!--</el-tooltip>
                                <el-tooltip v-if="authentication(34)" class="item" effect="dark" content="接口资源" placement="bottom">-->
                                    <!--<el-button
                                            v-if="authentication(34)"
                                            type="text"

                                            size="small"
                                            @click="openApiResource(scope.row)">接口资源
                                    </el-button>--><!--icon="fa fa-adn"-->
                               <!-- </el-tooltip>
                                <el-tooltip v-if="authentication(2)" class="item" effect="dark" content="删除角色信息" placement="bottom">-->
                                    <el-button
                                            v-if="authentication(2)"
                                            type="text"
                                            size="small"
                                            @click="handleDel(scope.$index, scope.row)">删除
                                    </el-button><!--icon="el-icon-delete"-->
                                <!--</el-tooltip>-->
                            </el-button-group>
                        </div>
                    </template>
                </el-table-column>
            </el-table>

            <div align="center">
                <el-pagination
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="currentPage"
                        :page-sizes="[10, 20, 30, 40]"
                        :page-size="pagesize"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="totalCount">
                </el-pagination>
            </div>
    </el-main>
</el-container>
</div>

<#include "/comm/js.html">

<script type="text/javascript">
    let button = ${button};
    var vue = loadTable({
            data:{
                search:{
                    name:{op:"cn",data:""},
                    editor:{op:"cn",data:""}
                    /*gmtModified:[{op:"le",data:""},{op:"ge",data:""}]*/
                },
                button:button
            },
            methods:{
                openModuleResource: function (row) {
                    v.dialogShow(1, {
                        title: '分配资源权限',
                        url: '${base}/resource/roleAndModuleResourceEntrance/${iframe}/'+row.id,
                        width: 420,
                        height: 400
                    })
                },
                openApiResource: function (row) {
                    v.dialogShow(1, {
                        title: '分配接口权限',
                        url: '${base}/resource/roleAndApiResourceEntrance/${iframe}/'+row.id,
                        width: 420,
                        height: 400
                    })
                },
                formatEditor: function (row,column) {
                    //console.log(column);
                    return row.editor.split(".")[1];
                }
            },
            urlList:"${base}/role/listByPage",
            urlDel:"${base}/role/delRole/",
            urlEdit:"${base}/role/editEntrance/${iframe}",
            urlChangeOrder:"${base}/role/changeOrder",
            dialogWidth:400,
            dialogHeight:350,
            title:'角色'
        });

</script>
</body>
</html>