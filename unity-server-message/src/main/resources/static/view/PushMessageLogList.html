<#include "/comm/head.html"/>
<body>
<style>
    .el-header .el-input__inner{ width:140px; }
    .el-date-editor { width:140px !important; }
    .el-main {
        padding: 0px;
        margin: 0px;
        overflow:visible !important;
    }

</style>
<div id="app">
<el-container>
    <el-header>

        <div  style="height:40px;padding-top: 5px;">

            <el-form :inline="true">
                <el-button-group>
                    <el-tooltip v-show="authentication(0)" class="item" effect="dark" content="添加" placement="bottom">
                        <el-button type="primary" icon="el-icon-circle-plus-outline" @click="handleAdd()"></el-button>
                    </el-tooltip>

                </el-button-group>
                <!--<el-form-item label="业务类型" prop="bizType">
                    <el-select v-model="search.bizType.data">
                        <el-option v-for="(item, index) in bizTypeList" :key="item.id" :value="item.id" :label="item.name"></el-option>
                    </el-select>
                </el-form-item>-->
                <el-form-item label="标题">
                    <el-input style="wdith:60px"  v-model="search.title.data" placeholder="请输入标题"></el-input>
                </el-form-item>
                <el-button-group>
                    <el-tooltip  class="item" effect="dark" content="搜索" placement="bottom">
                        <el-button type="primary" icon="el-icon-search" @click="handleSearch()"></el-button>
                    </el-tooltip>
                    <el-tooltip  class="item" effect="dark" content="清空" placement="bottom">
                        <el-button type="primary" icon="fa fa-repeat" @click="handleReset()"></el-button>
                    </el-tooltip>
                </el-button-group>
            </el-form>

        </div>
    </el-header>
    <el-main>
            <el-table
                    :data="tableData"
                    style='width:100%;'
                    :height="tableHeight"
                    @selection-change="handleSelectionChange"
                    border>
                <el-table-column
                        type="selection"
                        width="55">
                </el-table-column>
                <el-table-column
                        type="index"
                        label="序号"
                        width="50">
                </el-table-column>
                <el-table-column
                        prop='title'
                        label="标题"
                        width="200">
                </el-table-column>
                <!--<el-table-column
                        prop='bizTypeTitle'
                        label="业务类型"
                        width="80">
                </el-table-column>-->
                <!--<el-table-column
                        prop='content'
                        label="文本消息内容"
                        width="250">
                </el-table-column>-->
                <el-table-column
                        prop='gmtModified'
                        label="修改时间"
                        width="200">
                </el-table-column>
                <el-table-column
                        prop='editor'
                        label="修改人"
                        width="100">
                </el-table-column>
                <el-table-column
                        fixed="right"
                        label="操作">
                    <template slot-scope="scope">

                        <el-button v-show="authentication(2)"
                                size="small"
                                type="text"
                                @click="handleDel(scope.$index, scope.row)">删除</el-button>

                        <el-button
                                v-if="scope.row.recordStatus===0"
                                v-show="authentication(1)"
                                size="small"
                                type="text"
                                @click="handleEdit(scope.$index, scope.row)">修改</el-button>
                        <el-button
                                v-if="scope.row.recordStatus===1"
                                v-show="authentication(1)"
                                size="small"
                                type="text"
                                @click="handleEdit(scope.$index, scope.row)">详情</el-button>

                        <el-button
                                v-if="scope.row.recordStatus===0"
                                v-if="authentication(100) "
                                type="text"
                                size="small"
                                @click="release(scope.row)"
                                >发布
                        </el-button>
                    </template>
                </el-table-column>
            </el-table>

            <div align="center">
                <el-pagination
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="currentPage"
                        :page-sizes="[10, 20, 30, 40]"
                        :page-size="pagesize"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="totalCount">
                </el-pagination>
            </div>
    </el-main>
</el-container>
</div>

<#include "/comm/js.html"/>

<script type="text/javascript">

    var vue = loadTable({
        data: {
            button:${button},
            search: {
                title: {op: "cn", data: ""},
                editor: {op: "cn", data: ""},
                bizType: {op: "eq", data: ""}
            }
           /* , bizTypeList: [
                {id: '', name: '全部'},
                {id:'1',name:'推送'},
                {id:'2',name:'公告'}
            ]*/
            , recordStatusList: [
                {id: '', name: '全部'}
                , {id: '1', name: '成功'}
                , {id: '-1', name: '失败'}
            ]
            , flagList: [
                {id: '', name: '全部'}
                , {id: '1', name: '是'}
                , {id: '0', name: '否'}
            ]
        },
        urlList: "${base}/pushmessagelog/listByPage",
        urlDel: "${base}/pushmessagelog/del/",
        urlEdit: "${base}/pushmessagelog/view/editEntrance/${iframe}",
        urlChangeOrder: "${base}/pushmessagelog/changeOrder",
        dialogWidth: 1200,
        dialogHeight: 700,
        title: '公告消息',
        dialogIndex: 0,
        methods: {
            release:async function (row) {
                console.log(row);
                let r = await v.$confirm('确认发布消息嘛？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'}).catch(() => {});
                if (r == 'confirm') {
                    let {data} = await axios.get('${base}/pushmessagelog/release/' + row.id);
                    if (data.code == 0) {
                        this.$message({type: 'success', message: data.message});
                        this.reload();
                    }else {
                        this.$message({type: 'error', message: data.message});
                    }
                }
            }
        }
    });




</script>
</body>
</html>